present <- weekly_prec[[(i+9)]]
mean_eightweek <- calc(eightweek, fun = mean)
noaa <- (present/mean_eightweek)
plot(noaa)
i = i+1
x = x+1
}
i = 1
x = 9
list <- list()
while (x < nlayers(weekly_prec)) {
eightweek <- weekly_prec[[i:(i+8)]]
present <- weekly_prec[[(i+9)]]
mean_eightweek <- calc(eightweek, fun = mean)
noaa <- (present/mean_eightweek)
plot(noaa)
list[[i]] <- noaa
i = i+1
x = x+1
}
list
devtools::build()
devtools::install()
install.packages("mapview")
library(SouthAfricaDrought)
library(geospaar)
library(sf)
library(rgdal)
library(raster)
afalb <- paste0("+proj=aea +lat_1=20 +lat_2=-23 +lat_0=0 +lon_0=25 +x_0=0 ", "+y_0=0 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs")
#Load South Africa boundary and reprojects to Hartebeesthoek94
boundary <- system.file("extdata/SouthAfrica_Boundary.shp", package = "SouthAfricaDrought") %>% st_read() %>% st_transform(x = ., crs = afalb)
#Load long-term monthly data and reprojects custom projection for SA
lt_monthly_prec <- system.file("extdata/SA_30yr_LT_Mean_Precip.tif", package = "SouthAfricaDrought") %>% stack() %>% projectRaster(., crs = afalb)
#Rename according to month
names(lt_monthly_prec) <- c('Nov_87_17', 'Dec_87_17', 'Jan_88_18', 'Feb_88_18', 'March_88_18')
#Load summer monthly data and reprojects custom projection for SA
monthly_prec <- system.file("extdata/SA_Chirps_Monthly_Mean_Precip.tif", package = "SouthAfricaDrought") %>% stack() %>% projectRaster(., crs = afalb)
#Rename layers accoridng to their month
names(monthly_prec) <- c('Nov_2019', 'Dec_2019', 'Jan_2020', 'Feb_2020', 'March_2020')
plot(monthly_prec)
#Load summer weekly precipitation values (mm) and reprojects custom projection for SA
weekly_prec <- system.file("extdata/SA_Chirps_Weekly_Mean_Precip.tif", package = "SouthAfricaDrought") %>% stack() %>% projectRaster(., crs = afalb)
#Rename precipitation layers according to the data range of each image
names(weekly_prec) <- c('week1_2019-10-27_2019-11-02',
'week2_2019-11-17_2019-11-23',
'week3_2019-11-24_2019-11-30',
'week4_2019-12-01_2019-12-07',
'week5_2019-12-08_2019-12-14',
'week6_2019-12-15_2019-12-21',
'week7_2019-12-22_2019-12-28',
'week8_2019-12-29_2019-01-05',
'week9_2019-01-06_2019-01-12',
'week10_2019-01-13_2019-01-19',
'week11_2019-01-20_2019-01-26',
'week12_2019-01-27_2019-02-02',
'week13_2019-02-03_2019-02-09',
'week14_2019-02-10_2019-02-16',
'week15_2019-02-17_2019-02-23',
'week16_2019-02-24_2019-03-02',
'week17_2019-03-10_2019-03-16',
'week18_2019-03-17_2019-02-23',
'week19_2019-03-24_2019-03-30',
'week20_2019-03-31_2019-04-06',
'week21_2019-04-07_2019-04-13',
'week22_2019-04-14_2019-04-20',
'week23_2019-02-21_2019-02-27')
result_list <- list()
noaa_drought(weekly_prec, result_list)
result_list
i = 1
x = 9
list <- list()
while (x < nlayers(weekly_prec)) {
eightweek <- weekly_prec[[i:(i + 8)]]
present <- weekly_prec[[(i + 9)]]
mean_eightweek <- calc(eightweek, fun = mean)
noaa <- (present/mean_eightweek)
plot(noaa)
list[[i]] <- noaa
i = i+1
x = x+1
}
i = 1
x = 9
list <- list()
noaa_drought <- function(weekly_prec, list){
while (x < nlayers(weekly_prec)) {
eightweek <- weekly_prec[[ i:(i + 8) ]]
present <- weekly_prec[[(i + 9)]]
mean_eightweek <- calc(eightweek, fun = mean)
noaa <- (present / mean_eightweek)
plot(noaa)
list[[i]] <- noaa
i = i + 1
x = x + 1
}
}
new_list <- list()
noaa_drought <- function(weekly_prec, list){
while (x < nlayers(weekly_prec)) {
eightweek <- weekly_prec[[ i:(i + 8) ]]
present <- weekly_prec[[(i + 9)]]
mean_eightweek <- calc(eightweek, fun = mean)
noaa <- (present / mean_eightweek)
plot(noaa)
list[[i]] <- noaa
i = i + 1
x = x + 1
}
}
noaa_drought(weekly_prec, new_list)
new_list
i = 1
x = 9
new_list <- list()
noaa_drought <- function(weekly_prec, list){
while (x < nlayers(weekly_prec)) {
eightweek <- weekly_prec[[ i:(i + 8) ]]
present <- weekly_prec[[(i + 9)]]
mean_eightweek <- calc(eightweek, fun = mean)
noaa <- (present / mean_eightweek)
plot(noaa)
list[[i]] <- noaa
return(list)
i = i + 1
x = x + 1
}
}
noaa_drought(weekly_prec, new_list)
new_list
variable <- noaa_drought(weekly_prec, new_list)
variable
noaa_drought <- function(weekly_prec, list){
while (x < nlayers(weekly_prec)) {
eightweek <- weekly_prec[[ i:(i + 8) ]]
present <- weekly_prec[[(i + 9)]]
mean_eightweek <- calc(eightweek, fun = mean)
noaa <- (present / mean_eightweek)
plot(noaa)
list[[i]] <- noaa
i = i + 1
x = x + 1
}
}
variable <- noaa_drought(weekly_prec, list)
variable
variable
noaa_drought <- function(weekly_prec, list){
while (x < nlayers(weekly_prec)) {
eightweek <- weekly_prec[[ i:(i + 8) ]]
present <- weekly_prec[[(i + 9)]]
mean_eightweek <- calc(eightweek, fun = mean)
noaa <- (present / mean_eightweek)
plot(noaa)
list[[i]] <- noaa
return(list)
i = i + 1
x = x + 1
}
}
variable <- noaa_drought(weekly_prec, list)
noaa_drought <- function(weekly_prec, list){
while (x < nlayers(weekly_prec)) {
eightweek <- weekly_prec[[ i:(i + 8) ]]
present <- weekly_prec[[(i + 9)]]
mean_eightweek <- calc(eightweek, fun = mean)
noaa <- (present / mean_eightweek)
plot(noaa)
list[[i]] <- noaa
i = i + 1
x = x + 1
}
return(list)
}
variable <- noaa_drought(weekly_prec, list)
variable
devtools::build()
result_list <- list()
noaa_drought(weekly_prec, result_list) %>% stack()
noaa_stack <- noaa_drought(weekly_prec, result_list) %>% stack()
noaa_stack
install.packages("leaflet")
install.packages("shiny")
library(shinydashboard)
install.packages("shinydashboard")
library(SouthAfricaDrought)
library(geospaar)
library(sf)
library(rgdal)
library(raster)
library(shiny)
library(shinydashboard)
library(leaflet)
afalb <- paste0("+proj=aea +lat_1=20 +lat_2=-23 +lat_0=0 +lon_0=25 +x_0=0 ", "+y_0=0 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs")
#Load South Africa boundary and reprojects to Hartebeesthoek94
boundary <- system.file("extdata/SouthAfrica_Boundary.shp", package = "SouthAfricaDrought") %>% st_read() %>% st_transform(x = ., crs = afalb)
#Load long-term monthly data and reprojects custom projection for SA
lt_monthly_prec <- system.file("extdata/SA_30yr_LT_Mean_Precip.tif", package = "SouthAfricaDrought") %>% stack() %>% projectRaster(., crs = afalb)
#Rename according to month
names(lt_monthly_prec) <- c('Nov_87_17', 'Dec_87_17', 'Jan_88_18', 'Feb_88_18', 'March_88_18')
#Load summer monthly data and reprojects custom projection for SA
monthly_prec <- system.file("extdata/SA_Chirps_Monthly_Mean_Precip.tif", package = "SouthAfricaDrought") %>% stack() %>% projectRaster(., crs = afalb)
#Rename layers accoridng to their month
names(monthly_prec) <- c('Nov_2019', 'Dec_2019', 'Jan_2020', 'Feb_2020', 'March_2020')
plot(monthly_prec)
#Load summer weekly precipitation values (mm) and reprojects custom projection for SA
weekly_prec <- system.file("extdata/SA_Chirps_Weekly_Mean_Precip.tif", package = "SouthAfricaDrought") %>% stack() %>% projectRaster(., crs = afalb)
#Rename precipitation layers according to the data range of each image
names(weekly_prec) <- c('week1_2019-10-27_2019-11-02',
'week2_2019-11-17_2019-11-23',
'week3_2019-11-24_2019-11-30',
'week4_2019-12-01_2019-12-07',
'week5_2019-12-08_2019-12-14',
'week6_2019-12-15_2019-12-21',
'week7_2019-12-22_2019-12-28',
'week8_2019-12-29_2019-01-05',
'week9_2019-01-06_2019-01-12',
'week10_2019-01-13_2019-01-19',
'week11_2019-01-20_2019-01-26',
'week12_2019-01-27_2019-02-02',
'week13_2019-02-03_2019-02-09',
'week14_2019-02-10_2019-02-16',
'week15_2019-02-17_2019-02-23',
'week16_2019-02-24_2019-03-02',
'week17_2019-03-10_2019-03-16',
'week18_2019-03-17_2019-02-23',
'week19_2019-03-24_2019-03-30',
'week20_2019-03-31_2019-04-06',
'week21_2019-04-07_2019-04-13',
'week22_2019-04-14_2019-04-20',
'week23_2019-02-21_2019-02-27')
#Display final maps of drought -- times series of drought areas?
ui <- fluidPage(
titlePanel("Weekly NOAA Drought Monitoring"),
# Sidebar layout with input and output definitions ----
sidebarLayout(
# Sidebar panel for inputs ----
sidebarPanel(
sliderInput(inputId = "bins", label = "week", min = 1, max = nlayers(noaa_stack), value = 1)
),
# Main panel for displaying outputs ----
mainPanel(
# Output: Histogram ----
leafletOutput(outputId = "Raster")
)
)
)
server <- function(input, output) {
output$Raster <- renderLeaflet({
m <- c(0, .60, 0, .60, max(noaa_stack), 1)
rclmat <- matrix(m, ncol=2, byrow=TRUE)
rc <- reclassify(noaa_stack, rclmat)
leaflet() %>% addRasterImage(rc)
})
}
shinyApp(ui, server)
water_stress <- function(x){
q <- x <= .60
q[q==0] <- NA
}
reclass_stack <- stack(lapply(1:nlayers(noaa_stack), function(i){water_stress(noaa_stack[[i]])}))
test <- water_stress(noaa_stack[[1]])
plot(test)
water_stress <- function(x){
q <- x < .60
q[q==0] <- NA
}
test <- water_stress(noaa_stack[[1]])
plot(test)
m <- c(0, 0.6, NA,  0.6, max(noaa_stack), 1)
m
rclmat <- matrix(m, ncol=3, byrow=TRUE)
rclmat
values(noaa_stack)
maxValue(noaa_stack)
max(noaa_stack)
max(MaxValue(raster))
max(maxValue(raster))
max(maxValue(noaa_stack))
m <- c(0, 0.6, NA,  0.6, Inf, 1)
rclmat <- matrix(m, ncol=3, byrow=TRUE)
rclmat
rc <- reclassify(noaa_stack[1], rclmat)
rc <- reclassify(noaa_stack[[1]}, rclmat)
test <- water_stress(noaa_stack[[1]])
plot(test)
reclass_stack <- stack(lapply(1:nlayers(noaa_stack), function(i){water_stress(noaa_stack[[i]])}))
rc <- reclassify(noaa_stack[[1]], rclmat)
rc
#Display final maps of drought -- times series of drought areas?
ui <- fluidPage(
titlePanel("Weekly NOAA Drought Monitoring"),
# Sidebar layout with input and output definitions ----
sidebarLayout(
# Sidebar panel for inputs ----
sidebarPanel(
sliderInput(inputId = "bins", label = "week", min = 1, max = nlayers(noaa_stack), value = 1)
),
# Main panel for displaying outputs ----
mainPanel(
# Output: Histogram ----
leafletOutput(outputId = "Raster")
)
)
)
server <- function(input, output) {
output$Raster <- renderLeaflet({
m <- c(0, 0.6, NA,  0.6, Inf, 1)
rclmat <- matrix(m, ncol=3, byrow=TRUE)
rc <- reclassify(noaa_stack[[1]], rclmat)
leaflet() %>% addRasterImage(rc)
})
}
shinyApp(ui, server)
#Display final maps of drought -- times series of drought areas?
ui <- fluidPage(
titlePanel("Weekly NOAA Drought Monitoring"),
# Sidebar layout with input and output definitions ----
sidebarLayout(
# Sidebar panel for inputs ----
sidebarPanel(
sliderInput(inputId = "bins", label = "week", min = 1, max = nlayers(noaa_stack), value = 1)
),
# Main panel for displaying outputs ----
mainPanel(
# Output: Histogram ----
leafletOutput(outputId = "Raster")
)
)
)
server <- function(input, output) {
output$Raster <- renderLeaflet({
m <- c(0, 0.6, NA,  0.6, Inf, 1)
rclmat <- matrix(m, ncol=3, byrow=TRUE)
rc <- reclassify(noaa_stack[[1]], rclmat)
leaflet() %>% addRasterImage(rc)
})
}
shinyApp(ui, server)
#Display final maps of drought -- times series of drought areas?
ui <- fluidPage(
titlePanel("Weekly NOAA Drought Monitoring"),
# Sidebar layout with input and output definitions ----
sidebarLayout(
# Sidebar panel for inputs ----
sidebarPanel(
sliderInput(inputId = "bins", label = "week", min = 1, max = nlayers(noaa_stack), value = 1)
),
# Main panel for displaying outputs ----
mainPanel(
# Output: Histogram ----
leafletOutput(outputId = "Raster")
)
)
)
server <- function(input, output) {
output$Raster <- renderLeaflet({
m <- c(0, 0.6, NA,  0.6, Inf, 1)
rclmat <- matrix(m, ncol=3, byrow=TRUE)
rc <- reclassify(noaa_stack, rclmat)
leaflet() %>% addRasterImage(rc)
})
}
shinyApp(ui, server)
water_stress <- function(x){
m <- c(0, 0.6, NA,  0.6, Inf, 1)
rclmat <- matrix(m, ncol=3, byrow=TRUE)
rc <- reclassify(noaa_stack, rclmat)
}
reclass_stack <- stack(lapply(1:nlayers(noaa_stack), function(i){water_stress(noaa_stack[[i]])}))
reclass_stack
plot(reclass_stack)
water_stress <- function(x){
m <- c(0, 0.6, 1,  0.6, Inf, NA)
rclmat <- matrix(m, ncol=3, byrow=TRUE)
rc <- reclassify(noaa_stack, rclmat)
}
reclass_stack <- stack(lapply(1:nlayers(noaa_stack), function(i){water_stress(noaa_stack[[i]])}))
plot(reclass_stack)
devtools::build()
devtools::build()
devtools::build()
devtools::build()
devtools::install()
library(SouthAfricaDrought)
result_list <- list()
noaa_stack <- noaa_drought(weekly_prec, result_list) %>% stack()
noaa_class_stack <- noaa_class(noaa_stack)
noaa_class_stack
plot(noaa_class_stack)
devtools::load_all()
noaa_class_stack <- SouthAfricaDrought::noaa_class(noaa_stack)
plot(noaa_class_stack)
#Rename precipitation layers according to the data range of each image
week_names <- c('week1_2019-10-27_2019-11-02',
'week2_2019-11-17_2019-11-23',
'week3_2019-11-24_2019-11-30',
'week4_2019-12-01_2019-12-07',
'week5_2019-12-08_2019-12-14',
'week6_2019-12-15_2019-12-21',
'week7_2019-12-22_2019-12-28',
'week8_2019-12-29_2019-01-05',
'week9_2019-01-06_2019-01-12',
'week10_2019-01-13_2019-01-19',
'week11_2019-01-20_2019-01-26',
'week12_2019-01-27_2019-02-02',
'week13_2019-02-03_2019-02-09',
'week14_2019-02-10_2019-02-16',
'week15_2019-02-17_2019-02-23',
'week16_2019-02-24_2019-03-02',
'week17_2019-03-10_2019-03-16',
'week18_2019-03-17_2019-02-23',
'week19_2019-03-24_2019-03-30',
'week20_2019-03-31_2019-04-06',
'week21_2019-04-07_2019-04-13',
'week22_2019-04-14_2019-04-20',
'week23_2019-02-21_2019-02-27')
names(weekly_prec) <- week_names
names(noaa_class_stack) <- c('week9_2019-01-06_2019-01-12',
'week10_2019-01-13_2019-01-19',
'week11_2019-01-20_2019-01-26',
'week12_2019-01-27_2019-02-02',
'week13_2019-02-03_2019-02-09',
'week14_2019-02-10_2019-02-16',
'week15_2019-02-17_2019-02-23',
'week16_2019-02-24_2019-03-02',
'week17_2019-03-10_2019-03-16',
'week18_2019-03-17_2019-02-23',
'week19_2019-03-24_2019-03-30',
'week20_2019-03-31_2019-04-06',
'week21_2019-04-07_2019-04-13',
'week22_2019-04-14_2019-04-20',
'week23_2019-02-21_2019-02-27')
names(noaa_class_stack) <- c('week9_2019-01-06_2019-01-12',
'week10_2019-01-13_2019-01-19',
'week11_2019-01-20_2019-01-26',
'week12_2019-01-27_2019-02-02',
'week13_2019-02-03_2019-02-09',
'week14_2019-02-10_2019-02-16',
'week15_2019-02-17_2019-02-23',
'week16_2019-02-24_2019-03-02',
'week17_2019-03-10_2019-03-16',
'week18_2019-03-17_2019-02-23',
'week19_2019-03-24_2019-03-30',
'week20_2019-03-31_2019-04-06',
'week21_2019-04-07_2019-04-13',
'week22_2019-04-14_2019-04-20',
'week23_2019-02-21_2019-02-27')
noaa_class_stack
names(noaa_class_stack) <- c('week9_2019-01-06_2019-01-12',
'week10_2019-01-13_2019-01-19',
'week11_2019-01-20_2019-01-26',
'week12_2019-01-27_2019-02-02',
'week13_2019-02-03_2019-02-09',
'week14_2019-02-10_2019-02-16',
'week15_2019-02-17_2019-02-23',
'week16_2019-02-24_2019-03-02',
'week17_2019-03-10_2019-03-16',
'week18_2019-03-17_2019-02-23',
'week19_2019-03-24_2019-03-30',
'week20_2019-03-31_2019-04-06',
'week21_2019-04-07_2019-04-13',
'week22_2019-04-14_2019-04-20',
#'week23_2019-02-21_2019-02-27')
plot(noaa_class_stack)
names(noaa_class_stack) <- c('week9_2019-01-06_2019-01-12',
'week10_2019-01-13_2019-01-19',
'week11_2019-01-20_2019-01-26',
'week12_2019-01-27_2019-02-02',
'week13_2019-02-03_2019-02-09',
'week14_2019-02-10_2019-02-16',
'week15_2019-02-17_2019-02-23',
'week16_2019-02-24_2019-03-02',
'week17_2019-03-10_2019-03-16',
'week18_2019-03-17_2019-02-23',
'week19_2019-03-24_2019-03-30',
'week20_2019-03-31_2019-04-06',
'week21_2019-04-07_2019-04-13',
'week22_2019-04-14_2019-04-20')
names(noaa_class_stack) <- c('week9_2019-01-06_2019-01-12',
'week10_2019-01-13_2019-01-19',
'week11_2019-01-20_2019-01-26',
'week12_2019-01-27_2019-02-02',
'week13_2019-02-03_2019-02-09',
'week14_2019-02-10_2019-02-16',
'week15_2019-02-17_2019-02-23',
'week16_2019-02-24_2019-03-02',
'week17_2019-03-10_2019-03-16',
'week18_2019-03-17_2019-02-23',
'week19_2019-03-24_2019-03-30',
'week20_2019-03-31_2019-04-06',
'week21_2019-04-07_2019-04-13',
'week22_2019-04-14_2019-04-20')
#'week23_2019-02-21_2019-02-27'
plot(noaa_class_stack)
names(noaa_class_stack) <- c('week9',
'week10',
'week11',
'week12',
'week13',
'week14',
'week15',
'week16',
'week17',
'week18',
'week19',
'week20',
'week21',
'week22')
#'week23_2019-02-21_2019-02-27'
plot(noaa_class_stack)
