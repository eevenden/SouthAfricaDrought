---
title: "Project_Overview"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Project_Overview}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Project Prompt

Use the SMS survey and co-located sensor rainfall data to identify mid-season dry-spells of potential agricultural significance. For example, two or more consecutive rainless weeks close to maize flowering or grain-filling times. Can you detect a signficant drop in farmers’ anticipated harvest amounts around such events (we might expect a sudden drop in expected harvest amounts)? How about a significant change in the rate of reduction in farmers’ reported maize storage levels fall (if farmers are concerned about crop loss, they might slow their rate of consumption of stored food)?


# Description

## Summary

In this project we aim to identify bouts of drought in South Africa over the period of 2008 and 2011. Drought will be determined by persisting stretches of no rainfall within a predetermined season. Our threshold for drought will be based on the Palmer Drought Severity Index (PDSI) with key components: temperature and precipitation. The PDSI indicates drought as a range -10 (dry) to 10 (wet) atmosphere, thus we are able to grade drought conditions to more desirable moist conditions. In this project, we aim to design a metric for determining drought spans in South African farms. The importance of this project is aligned to food security goals as planning for adverse or dry spells can be achieved with the information provided by our metric system. Timing of farming activities will also be optimised to produce the optimum yield per area utilised. 

# Primary Objectives:
Develop metric system for determining area-specific drought


# Approach and Method:

For the task of demonstrating the utility of a metric system for identifying periods of drought we obtained datasets for temperature and precipitation from Google Earth Engine (GEE) geodatabase. Following this, the datasets were clipped in R to the extent of the study area, South Africa. A function for calculating mean monthly amounts for the variables was applied on temperature and precipitation datasets and units converted where appropriate: Kelvin to degree Celsius. The next geoprocessing of the datasets was done in raster layers, and included calculating the mean of pixels throughout the months to produce a new output file.
```{r setup, error=TRUE}
library(SouthAfricaDrought)
library(geospaar)
library(sf)
library(rgdal)
library(raster)

afalb <- paste0("+proj=aea +lat_1=20 +lat_2=-23 +lat_0=0 +lon_0=25 +x_0=0 ", "+y_0=0 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs")

#Load South Africa boundary and reprojects to Hartebeesthoek94
boundary <- system.file("extdata/SouthAfrica_Boundary.shp", package = "SouthAfricaDrought") %>% st_read() %>% st_transform(x = ., crs = afalb)

plot(boundary)

#Load monthly data
monthly_prec <- system.file("extdata/SA_Chirps_Monthly_Mean_Precip.tif", package = "SouthAfricaDrought") %>% stack() %>% projectRaster(., crs = afalb)
                                                                                                                              names(monthly_prec) <- c('Nov_2019', 'Dec_2019', 'Jan_2020', 'Feb_2020', 'March_2020')
plot(monthly_prec)                                                                                                                              
#Load weekly precipitation values (mm) and reprojects to Hartebeesthoek94
weekly_prec <- system.file("extdata/SA_Chirps_Weekly_Mean_Precip.tif", package = "SouthAfricaDrought") %>% stack() %>% projectRaster(., crs = afalb)

#Rename precipitation layers according to the data range of each image
names(weekly_prec) <- c('week1_2019-10-27_2019-11-02',
                        'week2_2019-11-17_2019-11-23',
                        'week3_2019-11-24_2019-11-30',
                        'week4_2019-12-01_2019-12-07',
                        'week5_2019-12-08_2019-12-14',
                        'week6_2019-12-15_2019-12-21',
                        'week7_2019-12-22_2019-12-28',
                        'week8_2019-12-29_2019-01-05',
                        'week9_2019-01-06_2019-01-12',
                        'week10_2019-01-13_2019-01-19',
                        'week11_2019-01-20_2019-01-26',
                        'week12_2019-01-27_2019-02-02',
                        'week13_2019-02-03_2019-02-09',
                        'week14_2019-02-10_2019-02-16',
                        'week15_2019-02-17_2019-02-23',
                        'week16_2019-02-24_2019-03-02',
                        'week17_2019-03-10_2019-03-16',
                        'week18_2019-03-17_2019-02-23',
                        'week19_2019-03-24_2019-03-30',
                        'week20_2019-03-31_2019-04-06',
                        'week21_2019-04-07_2019-04-13',
                        'week22_2019-04-14_2019-04-20',
                        'week23_2019-02-21_2019-02-27')

```

## Methods

- Deciles

- NOAA Drought Index -  Mean precipitation for each week is calculated and a running eight-week average of measured average precipitation is summed and compared. If the actual precipitation is greater than 60% of the normal precipitation for the eight-week period, then the current week is assumed to have little or no water stress. If stress is detected, it remains until the actual precipitation is at 60% or more of normal.

- Temperature above climatic monthly average?

```{r, error= TRUE}
#Deciles
q1 <- quantile(monthly_prec, c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1), na.rm=TRUE)

q1

#NOAA Drough Index
```


# Data Visualization

# Results
